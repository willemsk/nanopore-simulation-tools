# Expected Output Structure

This document describes the complete directory structure and files generated by a successful workflow run with full parameter sweep.

## Output Overview

Running `just all` with default parameters generates:
- **PQR files**: Protonated structures at each pH value
- **APBS run directories**: One per PDB file × pH × ionic strength combination
- **Coefficient maps**: Dielectric, ion accessibility, and charge distributions
- **Electrostatic potentials**: Final results on coarse and fine grids
- **Log files**: APBS output for validation and energy extraction

## Directory Tree

```
OUTPUT/
├── pqr/
│   ├── chimera_mspa_oriented_pH{pH}.pqr
│   ├── chimera_mspa_oriented_pH{pH}.log
│   ├── pymol_mspa_oriented_pH{pH}.pqr
│   ├── pymol_mspa_oriented_pH{pH}.log
│   ├── vmd_mspa_oriented_pH{pH}.pqr
│   ├── vmd_mspa_oriented_pH{pH}.log
│   ├── wt_mspa_oriented_pH{pH}.pqr
│   └── wt_mspa_oriented_pH{pH}.log
│
└── apbs_runs/
    ├── chimera_mspa_oriented_pH{pH}_{ionc}M/
    ├── pymol_mspa_oriented_pH{pH}_{ionc}M/
    ├── vmd_mspa_oriented_pH{pH}_{ionc}M/
    └── wt_mspa_oriented_pH{pH}_{ionc}M/
        ├── TM.pqr                      # Symlink to PQR file
        │
        ├── apbs_dummy.in               # Dummy run APBS input
        ├── apbs_solv.in                # Solvation run APBS input
        ├── draw_membrane.in            # Membrane parameters
        │
        ├── dielx_L.dx                  # Dielectric (before membrane)
        ├── diely_L.dx
        ├── dielz_L.dx
        ├── kappa_L.dx                  # Ion accessibility (before membrane)
        ├── charge_L.dx                 # Charge distribution (before membrane)
        │
        ├── dielx_Lm.dx                 # Dielectric (after membrane)
        ├── diely_Lm.dx
        ├── dielz_Lm.dx
        ├── kappa_Lm.dx                 # Ion accessibility (after membrane)
        ├── charge_Lm.dx                # Charge distribution (after membrane)
        │
        ├── pot_Lm.dx                   # Electrostatic potential (coarse grid)
        ├── pot_Sm.dx                   # Electrostatic potential (fine grid)
        │
        ├── apbs_dummy.out              # Dummy run output log
        ├── apbs_solv.out               # Solvation run output log
        └── io.mc                       # APBS I/O temporary file
```

## File counts

For default configuration (`PH_VALUES="7.0"`, `IONC_VALUES="0.15"`, 4 PDB files):

**PQR generation:**
- 4 PQR files (one per PDB file at pH 7.0)
- 4 log files

**APBS runs:**
- 4 run directories (4 PDB files × 1 pH × 1 ionc)
- Each directory: 21 files total
  - 3 input files (.in)
  - 1 PQR symlink
  - 11 coefficient maps (.dx before and after membrane)
  - 2 potential maps (.dx)
  - 2 output logs (.out)
  - 1 temporary file (io.mc)

**Total:** 4 PQR directories + 84 files in APBS run directories = ~88 files

### Full parameter sweep example

For `PH_VALUES="6.0 7.0 8.0"` and `IONC_VALUES="0.05 0.10 0.15 0.20"`:

**PQR files:** 4 PDB × 3 pH = 12 PQR files + 12 logs

**APBS run directories:** 4 PDB × 3 pH × 4 ionc = 48 directories

**Total files:** 24 (PQR) + (48 × 21) = 1,032 files

## Critical files for validation

### Must exist for complete calculation

**Per PDB file:**
- `OUTPUT/pqr/{protein}_pH{pH}.pqr` - Protonated structure

**Per run directory:**
- `TM.pqr` - Structure file (symlink should not be broken)
- `pot_Lm.dx` - Coarse grid electrostatic potential (primary result)
- `pot_Sm.dx` - Fine grid electrostatic potential (if using focused calculation)
- `apbs_solv.out` - Solvation run log (contains energy values)

### Success indicators in log files

**PDB2PQR logs (`*.log` in `OUTPUT/pqr/`):**
- Should complete without errors
- May contain warnings about missing atoms (check if acceptable)
- Final line typically indicates success

**APBS logs (`apbs_solv.out` in run directories):**
```
Global net ELEC energy = -X.XXXXXXE+XX kJ/mol
```
This line indicates successful completion. Absence suggests calculation failure.

## File sizes

Typical file sizes (coarse grid: `DIME=65 65 65`):

- **PQR files:** 500 KB - 2 MB (depends on protein size)
- **Input files (.in):** ~1-2 KB each
- **Coefficient maps (.dx):** ~1-2 MB each
- **Potential maps (.dx):** ~1-2 MB each
- **Log files (.out):** 10-50 KB

**Per run directory:** ~20-30 MB

**Full default run:** ~80-120 MB

### Fine grid sizes

With fine grid settings (`DIME=417 417 449`):

- **Coefficient maps (.dx):** ~300-400 MB each
- **Potential maps (.dx):** ~300-400 MB each
- **Per run directory:** ~5-7 GB

**Full parameter sweep (48 directories):** ~240-340 GB

## Validation command

Check for expected structure:

```bash
# Run built-in validation
just validate

# Manual checks
# Count PQR files (should equal: # PDB files × # pH values)
find OUTPUT/pqr/ -name "*.pqr" | wc -l

# Count run directories (should equal: # PDB files × # pH values × # ionc values)
find OUTPUT/apbs_runs/ -mindepth 1 -maxdepth 1 -type d | wc -l

# Check for critical output files
find OUTPUT/apbs_runs/ -name "pot_Lm.dx" | wc -l
find OUTPUT/apbs_runs/ -name "pot_Sm.dx" | wc -l

# Check for successful APBS completions
grep -r "Global net ELEC energy" OUTPUT/apbs_runs/*/apbs_solv.out | wc -l
```

## Missing or incomplete outputs

If files are missing:

```bash
# Identify incomplete directories
just validate            # Built-in validation with detailed output

# Resume failed calculations
just resume             # Re-run only incomplete calculations
```

Common reasons for incomplete outputs:
- **Grid dimension errors**: Invalid `DIME` values (check formula: `dime = c*2^(nlev+1) + 1`)
- **Atoms off mesh**: Protein extends beyond grid boundaries (increase `GRID` or adjust `GCENT`)
- **PDB2PQR failures**: Missing atoms or unrecognized residues (check `.log` files)
- **APBS crashes**: System compatibility issues or memory limits

## Disk space planning

Estimate required disk space before running:

```
Space = (# PDB files) × (# pH values) × (# ionc values) × (size per run dir)

Coarse grid:  4 × 3 × 4 × 25 MB  = ~1.2 GB
Fine grid:    4 × 3 × 4 × 6 GB   = ~288 GB
```

Ensure adequate disk space before starting large parameter sweeps.

## Output retention

**Essential for publication/analysis:**
- All PQR files
- `pot_Lm.dx` and `pot_Sm.dx` files
- `apbs_solv.out` files (for energy values)

**Can be deleted to save space:**
- Coefficient maps (`dielx_*.dx`, `kappa_*.dx`, `charge_*.dx`) - can be regenerated
- `apbs_dummy.out` logs - usually only needed for debugging
- `io.mc` files - temporary APBS files

**Compression for archival:**
```bash
# Compress coefficient maps (often not needed for analysis)
find OUTPUT/apbs_runs/ -name "diel*.dx" -o -name "kappa*.dx" -o -name "charge*.dx" | \
  xargs gzip

# Creates .dx.gz files, ~70-80% size reduction
```
